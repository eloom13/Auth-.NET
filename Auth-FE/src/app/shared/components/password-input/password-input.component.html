<div class="form-group">
  <div class="input-group">
    <input
      [type]="isVisible ? 'text' : 'password'"
      [formControl]="control"
      class="form-control"
      [placeholder]="label"
      [class.is-invalid]="(control.touched || control.dirty) && (control.invalid || showPasswordMatchError)"
      [id]="label"
    />
    <button
      *ngIf="showToggle"
      type="button"
      class="btn btn-outline-secondary p-2"
      (click)="onToggleVisibility()"
    >
      <i [class]="isVisible ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
    </button>
  </div>

  <!-- Password validation errors -->
  <div *ngIf="hasErrors || showPasswordMatchError" class="password-error-list">
    <div *ngIf="showPasswordMatchError" class="text-danger small">Passwords do not match</div>

    <div *ngIf="!showStrengthIndicators && errorMessage && (control.touched || control.dirty) && control.invalid" class="text-danger small">
      {{ errorMessage }}
    </div>
  </div>

  <!-- Password strength indicator -->
  <div *ngIf="showStrengthIndicators && control.value && !control.errors" class="mt-2 password-strength">
    <div class="strength-bar d-flex">
      <div class="bar" [class.active]="passwordStrength !== 'empty'" [class.weak]="passwordStrength === 'weak'"></div>
      <div class="bar" [class.active]="passwordStrength === 'medium' || passwordStrength === 'strong'" [class.medium]="passwordStrength === 'medium'"></div>
      <div class="bar" [class.active]="passwordStrength === 'strong'" [class.strong]="passwordStrength === 'strong'"></div>
    </div>
    <div class="strength-text small" [ngClass]="{
      'text-danger': passwordStrength === 'weak',
      'text-warning': passwordStrength === 'medium',
      'text-success': passwordStrength === 'strong'
    }">
      <span *ngIf="passwordStrength === 'weak'">Weak</span>
      <span *ngIf="passwordStrength === 'medium'">Medium</span>
      <span *ngIf="passwordStrength === 'strong'">Strong</span>
    </div>
  </div>
</div>
